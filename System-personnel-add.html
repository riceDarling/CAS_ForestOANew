<!DOCTYPE HTML>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<title>赤峰市森林公安网上办公系统</title>
		<link rel="Bookmark" href="favicon.ico">
		<link rel="Shortcut Icon" href="favicon.ico" />
		<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
		<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
		<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
		<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
	</head>

	<body>
		<article class="page-container">
			<form action="" method="post" class="form form-horizontal" id="userInsertForm">
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>警号：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="text" class="input-text" value="" placeholder="" id="uNumber" name="uNumber">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>姓名：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="text" class="input-text" value="" placeholder="" id="uName" name="uName">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>性别：</label>
					<div class="formControls col-xs-8 col-sm-9 skin-minimal" id="sex">
						<div class="radio-box">
							<label><input name="sex" type="radio" class="input-radio" value="男"/>男</label>

						</div>
						<div class="radio-box">
							<label><input name="sex" type="radio" class="input-radio" value="女"/>女</label>
						</div>
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>手机：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="text" class="input-text" value="" placeholder="" id="phone" name="phone">
					</div>
				</div>
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>邮箱：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="text" class="input-text" placeholder="@" name="email" id="email">
					</div>
				</div>
				<!--<div class="row cl">-->
				<!--<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>组织名称：</label>-->
				<!--<div class="formControls col-xs-8 col-sm-9">-->
				<!--<select class="input-text" name="oId" id="oId">-->
				<!--<option value="1">内蒙古自治区森林公安</option>-->
				<!--<option value="2">赤峰市森林公安</option>-->
				<!--<option value="3">组织部</option>-->
				<!--<option value="4">政治部</option>-->
				<!--</select>-->
				<!--</div>-->

				<div  class="row cl">
					<div id="add" class="" style="height: 120px;overflow-y: scroll;">
						<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>组织名称：</label>
						<div class="formControls col-xs-8 col-sm-3">
							<input id="citySel" type="text" name="" onclick="showMenu(); return false;" class="input-text" value="" placeholder="请选择所属组织">
						</div>
						<div id="menuContent" class="menuContent" style=" background:#FFFFFF;width: 300px;height: 200px; overflow-y: scroll;display:none; position: absolute;z-index:100;">
							<!--<div class="formControls col-xs-8 col-sm-9" style="width: 300px;height: 520px; overflow-y: scroll;">-->
							<ul id="treeDemo" class="ztree" style="margin-top:0; width:160px;"></ul>
						</div>
						<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>职位名称：</label>
						<div class="formControls col-xs-8 col-sm-2" id="roles">
							<input id="" type="text" name=""   class="input-text" value="" placeholder="">
						</div>
						<label class="form-label col-xs-4 col-sm-1" style="text-align:left">
							<i id="addDepartment" class="Hui-iconfont Hui-iconfont-add" style="cursor: pointer;"></i>
						</label>
					</div>
				</div>
				<!--<div class="row cl">-->
				<!--<label class="form-label col-xs-4 col-sm-3">组织名称：</label>-->
				<!--<div class="formControls col-xs-8 col-sm-9">-->
				<!--<input id="citySel" type="text" name="" onclick="showMenu(); return false;" class="input-text"-->
				<!--value="" placeholder="请选择所属组织">-->
				<!--</div>-->

				<!--<div id="menuContent" class="menuContent" style="display:none; position: absolute;">-->
				<!--<ul id="treeDemo" class="ztree" style="margin-top:0; width:160px;"></ul>-->
				<!--</div>-->
				<!--</div>-->


				<!--<div class="row cl">-->
				<!--<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>登录账号：</label>-->
				<!--<div class="formControls col-xs-8 col-sm-9">-->
				<!--<input type="text" class="input-text" value="" placeholder="" id="loginName" name="loginName">-->
				<!--</div>-->
				<!--</div>-->
				<div class="row cl">
					<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>登录密码：</label>
					<div class="formControls col-xs-8 col-sm-9">
						<input type="text" class="input-text" value="" placeholder="" id="loginPassword" name="loginPassword">
					</div>
				</div>
				<div class="row cl">
					<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
						<!--<button type="submit" class="btn btn-success radius" id="userInsert" name="admin-role-save"><i-->
						<!--class="icon-ok"></i> 确定-->
						<!--</button>-->

						<input type="button" id="userInsert"  class="btn btn-primary radius" value="保存"/>
						<input type="button" onClick="layer_close();" class="btn btn-default radius" value="&nbsp;&nbsp;取消&nbsp;&nbsp;"></input>
					</div>
				</div>
			</form>
		</article>

		<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
		<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>

		<!--请在下方写此页面业务相关的脚本-->
		<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
		<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
		<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
		<script type="text/javascript" src="lib/zTree/v3/js/jquery.ztree.core-3.5.min.js"></script>
		<script type="text/javascript">
			var count = 1;
			$('#addDepartment').click(function(){
				var html=`<div class="removetr">
				<div class="formControls col-xs-8 col-sm-3 col-xs-offset-4 col-sm-offset-3 mt-20">
						<input id="${count}" type="text" name="" onclick="showMenu(); return false;" class="input-text" value="" placeholder="请选择所属组织">
					</div>
					<div id="menuContent" class="menuContent" style=" background:#FFFFFF;width: 300px;height: 200px; overflow-y: scroll;display:none; position: absolute;z-index:100;">
						<!--<div class="formControls col-xs-8 col-sm-9" style="width: 300px;height: 520px; overflow-y: scroll;">-->
						<ul id="treeDemo" class="ztree" style="margin-top:0; width:160px;"></ul>
					</div>
					<div class="formControls col-xs-8 col-sm-2 col-xs-offset-4 col-sm-offset-3 mt-20" id="roles">
						<input id="" type="text" name=""   class="input-text" value="" placeholder="">
					</div>
					<label class="form-label col-xs-4 col-sm-1" style="text-align:left;margin-top:20px;">
						<i class="Hui-iconfont Hui-iconfont-jianhao"  onclick="delDepartment(this)"  style="cursor: pointer;"></i>
					</label>
					</div>
				`
				$('#add').append(html);
				count++;
			})
			
			
			function delDepartment(el){
				$(el).parent().parent().remove();
			}
            //点击确定按钮向后台添加数据
            $("#userInsert").on("click", function () {
                var uNumber = $("#uNumber").val();
                var uName = $("#uName").val();
                var sex = $('#sex input[name="sex"]:checked ').val();
                var phone = $("#phone").val();
                var email = $("#email").val();
                var oId = $("#citySel").attr("name");
                var rId="";
                $("input:checkbox[name='rId']:checked").each(function() { // 遍历name=test的多选框
                    $(this).val();  // 每一个被选中项的值
                    rId+=$(this).val()+",";

                });

                // var oId = $("#oId").val();
                //var loginName = $("#loginName").val();
                var loginPassword = $("#loginPassword").val();

                if(uNumber=="") {
                    alert("警号不可以为空");
                    return false;
                }
                else{
                    reg=/^[0-9]*$/;
                    if(!reg.test(uNumber)){
                        alert("对不起，警号必须输入整数!");//请将“整数类型”要换成你要验证的那个属性名称！
                        return false;
                    }
                }
                if(uName=="") {
                    alert("姓名不可以为空");
                    return false;
                }
                if(sex=="") {
                    alert("性别不可以为空");
                    return false;
                }
                if(phone==""||phone.length!=11) {
                    alert("请输入正常的11位手机号！！");
                    return false;
                }else{
                    reg=/^[-+]?\d*$/;
                    if(!reg.test(phone)){
                        alert("对不起，手机好请输入的整数!");//请将“整数类型”要换成你要验证的那个属性名称！
                        return false;
                    }
                }
                if(oId=="") {
                    alert("组织不可以为空");
                    return false;
                }if(email=="") {
                    alert("邮箱不可以为空");
                    return false;
                }

                if(email.length!=0){
                    reg=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
                    if(!reg.test(email)){
                        alert("对不起，您输入的邮箱类型格式不正确!");
                        return false;
                    }
                }
                if(loginPassword=="") {
                    alert("登录密码不可以为空");
                    return false;
                }


//        $.ajax({
//            type: "POST",
//            url: "http://localhost:8080/forestoa/user/insert",
//            contentType: "application/json;charset=UTF-8",
//            //data: JSON.stringify(role),
//            data:{
//                "uNumber":uNumber,
//                "uName":uName,
//                "sex":sex,
//                "phone":phone,
//                "email":email,
//                "oId":oId,
//                "loginName":loginName,
//                "loginPassword":loginPassword
//            },
////            xhrFields: {
////                withCredentials: true
////            },
//            success: function(data) {
//                if(data.success) {
//                    //保存成功跳转到主页面
//                    window.location.href = "personnel-manage.html";
//                    window.parent.location.reload();
//                    parent.layer.close(index);
//                }
//            },
//        })
                $.ajax({
                    type: "post",
                    url: "http://localhost:8080/forestoa/user/insert",
//            data: $("#userInsertForm").serialize(),
                    data:{
                        "uNumber":uNumber,
                        "uName":uName,
                        "sex":sex,
                        "phone":phone,
                        "email":email,
                        "oId":oId,
                        "rIds":rId,
                        // "loginName":loginName,
                        "loginPassword":loginPassword
                    },

                    success: function (data) {

                        if (data.success == false) {
                            alert("人员已存在！！");
                        }

                        if (data.success==true) {
                            alert("添加成功！！");
                            //保存成功跳转到主页面
                            window.location.href = "System-personnel.html";
                            window.parent.location.reload();
                            parent.layer.close(index);
                        }
                    },
                    error: function () {
                    }
                });

            });

            var setting = {
                view: {
                    dblClickExpand: false
                },
                data: {
                    key: {
                        name: "oName"
                    },
                    simpleData: {
                        //enable: true,
                        idKey: "oId",
                        pIdKey: "parenteId",
                        rootPId: "",
                        nameKey: "oName"
                    }
                },
                callback: {
                    beforeClick: beforeClick,
                    onClick: onClick
                }
            };

            function beforeClick(treeId, treeNode) {
                return treeNode;

            }
            <!--点击树的节点所执行的函数-->
            function onClick(e, treeId, treeNode) {
                $.ajax({
                    type: "POST",
                    url: "http://localhost:8080/forestoa/role/findByoId",
                    data: {
                        "oId": treeNode.oId
                    },
                    dataType: "json",
                    success: function (result) {
                        var roles=result.data;
                        var arr="";
                        for(var i=0;i<roles.length;i++){
//                        alert(roles[i].rName)
                            if((i+1)%6==0){
                                arr+='<input name="rId" type="checkbox" value="'+roles[i].rId+'"><label>'+roles[i].rName+'</label><br>'
                            }else {
                                arr+='<input name="rId" type="checkbox" value="'+roles[i].rId+'"><label>'+roles[i].rName+'</label>'
                            }

                        }
                        $("#roles").empty().append(arr);
                    },
                    error: function (err) {
                        alert("error");
                    }
                });
                var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
                    nodes = zTree.getSelectedNodes(),
                    v = "";
                k = "";
                nodes.sort(function compare(a, b) {
                    return a.id - b.id;
                });
                for (var i = 0, l = nodes.length; i < l; i++) {
                    v += nodes[i].oName + ",";
                    k += nodes[i].oId;
                }
                if (v.length > 0) v = v.substring(0, v.length - 1);
                var cityObj = $("#citySel");
                $("#citySel").val(); //清空之前得值
                $("#citySel").val(v); //将oName给所属上级组织赋value值
                $("#citySel").attr("value", ""); //清空之前得name值
                $("#citySel").attr("name", k); //将oId给所属上级组织赋name值
                //cityObj.attr("value", v);
            }
            function showMenu() {
                var cityObj = $("#citySel");
                var cityOffset = $("#citySel").offset();
                $("#menuContent").css({
                    left: cityOffset.left + "px",
                    top: cityOffset.top + cityObj.outerHeight() + "px"
                }).slideDown("fast");

                $("body").bind("mousedown", onBodyDown);
            }
            function hideMenu() {
                $("#menuContent").fadeOut("fast");
                $("body").unbind("mousedown", onBodyDown);
            }

            function onBodyDown(event) {
                if (!(event.target.id == "menuBtn" || event.target.id == "menuContent" || $(event.target).parents("#menuContent").length > 0)) {
                    hideMenu();
                }
            }
            <!--组织树的初始化-->
            $(document).ready(function () {
				/*组织树查询*/
                $.ajax({
                    type: "POST",
                    url: "http://localhost:8080/forestoa/orgController/getOrgTree",
                    data: {
                        "oId": 1
                    },
                    dataType: "json",
                    success: function (result) {
                        zNodes = result.data;
                        $.fn.zTree.init($("#treeDemo"), setting, zNodes);
                    },
                    error: function (err) {
                        alert("error");
                    }
                });

            });









			$(function() {
				$(".permission-list dt input:checkbox").click(function() {
					$(this).closest("dl").find("dd input:checkbox").prop("checked", $(this).prop("checked"));
				});
				$(".permission-list2 dd input:checkbox").click(function() {
					var l = $(this).parent().parent().find("input:checked").length;
					var l2 = $(this).parents(".permission-list").find(".permission-list2 dd").find("input:checked").length;
					if($(this).prop("checked")) {
						$(this).closest("dl").find("dt input:checkbox").prop("checked", true);
						$(this).parents(".permission-list").find("dt").first().find("input:checkbox").prop("checked", true);
					} else {
						if(l == 0) {
							$(this).closest("dl").find("dt input:checkbox").prop("checked", false);
						}
						if(l2 == 0) {
							$(this).parents(".permission-list").find("dt").first().find("input:checkbox").prop("checked", false);
						}
					}
				});

				$("#form-admin-role-add").validate({
					rules: {
						roleNum:{
							required:true,
						},
						roleName: {
							required: true,
						},
						phone:{
							required:true,
						},
						email:{
							required:true,
							email:true
						}
					},
					onkeyup: false,
					focusCleanup: true,
					success: "valid",
					submitHandler: function(form) {
						$(form).ajaxSubmit();
						var index = parent.layer.getFrameIndex(window.name);
						parent.layer.close(index);
					}
				});
			});
		</script>
	</body>

</html>